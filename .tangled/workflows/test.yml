when:
  - event: ["push", "pull_request"]
    branch: main

engine: nixery

dependencies:
  nixpkgs:
    - git
  github:NixOS/nixpkgs/nixpkgs-unstable:
    - bun

steps:
  - name: install dependencies
    command: |
      export PATH="$HOME/.nix-profile/bin:$PATH"

      # have to regenerate otherwise it wont install necessary dependencies to run
      rm -rf bun.lock package-lock.json
      bun install @oven/bun-linux-aarch64
      bun install

  - name: run all tests
    command: |
      export PATH="$HOME/.nix-profile/bin:$PATH"
      bun test
